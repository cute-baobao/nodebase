name: Build Check

on:
  push:
    branches: [main, dev]
  pull_request:
    branches: [main, dev]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v2
        with:
          version: 8

      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: "pnpm"

      - name: Install dependencies
        run: pnpm install

      - name: Create .env.local for build
        run: |
          cat > .env.local << 'EOF'
          # DatabaseURL
          DATABASE_URL="postgresql://user:password@localhost:5432/nodebase"
          
          # BETTER_AUTH
          BETTER_AUTH_SECRET="random_secret_key_for_build_123456789"
          BETTER_AUTH_URL="http://localhost:3000"
          
          # GITHUB_OAUTH
          GITHUB_CLIENT_ID="test_github_client_id_12345"
          GITHUB_CLIENT_SECRET="test_github_client_secret_67890"
          
          # GOOGLE API KEY
          GOOGLE_GENERATIVE_AI_API_KEY="test_google_api_key_abc123"
          
          DEEPSEEK_API_KEY="test_deepseek_api_key_def456"
          
          OPENAI_API_KEY="test_openai_api_key_ghi789"
          
          SENTRY_AUTH_TOKEN="test_sentry_token_jkl012"
          
          POLAR_ACCESS_TOKEN="test_polar_token_mno345"
          POLAR_SUCCESS_URL="http://localhost:3000/success"
          
          NGROK_URL="http://localhost:4040"
          
          ENCRYPTION_KEY="test_encryption_key_pqr678test_encryption_key_pqr678"
          
          NEXT_PUBLIC_API_BASE_URL="http://localhost:3000/api"
          EOF

      - name: Build
        run: pnpm run build
